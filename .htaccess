# ---------------------------------------------
# .htaccess – jcacerespsicologo.com (Hostinger)
# Canonicalización + SEO + rendimiento estático
# ---------------------------------------------

# Activar motor de reescritura
RewriteEngine On

# -------------------------------------------------
# 1) Redirecciones específicas (evitar cadenas, 301)
#    -> siempre a la URL final absoluta en https://www
# -------------------------------------------------

# index.html → raíz
RewriteRule ^index\.html$ https://www.jcacerespsicologo.com/ [R=301,L]

# Slugs antiguos de WP/landings → slugs estáticos
RewriteRule ^aviso-legal/?$ https://www.jcacerespsicologo.com/aviso-legal.html [R=301,L]
RewriteRule ^politica-de-privacidad/?$ https://www.jcacerespsicologo.com/politica-privacidad.html [R=301,L]
RewriteRule ^politica-de-cookies/?$ https://www.jcacerespsicologo.com/politica-cookies.html [R=301,L]
RewriteRule ^terapia-pareja-roses/?$ https://www.jcacerespsicologo.com/terapia-pareja.html [R=301,L]
RewriteRule ^terapia-breve-online/?$ https://www.jcacerespsicologo.com/terapia-online.html [R=301,L]

# Endpoints/archivos del sitio antiguo → 410 (Gone)
RewriteRule ^wp-json/elementskit/v1/ - [G,L]
RewriteRule ^feed/?$ - [G,L]
RewriteRule ^category/ - [G,L]
RewriteRule ^tag/ - [G,L]
RewriteRule ^2022/07/28/hello-world/?$ - [G,L]

# -------------------------------------------------
# 2) Canonicalización global: HTTPS + WWW
#    (solo si no se cumplió una regla anterior)
# -------------------------------------------------
RewriteCond %{HTTPS} !=on [OR]
RewriteCond %{HTTP_HOST} !^www\.jcacerespsicologo\.com$ [NC]
RewriteRule ^(.*)$ https://www.jcacerespsicologo.com/$1 [R=301,L]

# -------------------------------------------------
# 3) Rendimiento (compresión y caché)
# -------------------------------------------------

# Compresión Brotli (si disponible)
<IfModule mod_brotli.c>
  AddOutputFilterByType BROTLI_COMPRESS text/plain text/html text/xml text/css application/javascript application/json image/svg+xml
</IfModule>

# Compresión GZIP (fallback)
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css application/javascript application/json image/svg+xml
</IfModule>

# Caché en navegador
<IfModule mod_expires.c>
  ExpiresActive On
  # HTML: sin cachear duro para evitar servir contenido obsoleto
  ExpiresByType text/html "access plus 0 seconds"
  # Estáticos versionados (mejor con querystring/hash en archivos)
  ExpiresByType text/css "access plus 1 year"
  ExpiresByType application/javascript "access plus 1 year"
  ExpiresByType application/json "access plus 1 day"
  ExpiresByType image/avif "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType font/woff2 "access plus 1 year"
</IfModule>

# -------------------------------------------------
# 4) Cabeceras de seguridad básicas
# -------------------------------------------------
<IfModule mod_headers.c>
  Header always set X-Content-Type-Options "nosniff"
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
  Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
  # HSTS (6 meses). Actívalo solo si el sitio funciona 100% en HTTPS
  Header always set Strict-Transport-Security "max-age=15552000"
</IfModule>

# -------------------------------------------------
# 5) Errores
# -------------------------------------------------
# 404 personalizado (sirve la home; 410 seguirá devolviendo estado 410)
ErrorDocument 404 /index.html
